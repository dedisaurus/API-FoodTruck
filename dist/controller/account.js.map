{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","Account","register","username","body","email","password","err","account","status","send","passport","authenticate","session","scope","generateAccessToken","respond","get","logout","json","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAkB;AAAA,QAAhBA,MAAgB,QAAhBA,MAAgB;AAAA,QAARC,EAAQ,QAARA,EAAQ;;AAC7B,QAAIC,MAAM,sBAAV;;AAGA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAY;AAC9BC,0BAAQC,QAAR,CAAiB,IAAID,iBAAJ,CAAY;AACzBE,sBAAUJ,IAAIK,IAAJ,CAASC;AADM,SAAZ,CAAjB,EAEIN,IAAIK,IAAJ,CAASE,QAFb,EAEuB,UAAUC,GAAV,EAAeC,OAAf,EAAwB;AAC3C,gBAAID,GAAJ,EAAS;AACN,uBAAOP,IAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,sBAAsBH,GAA3C,CAAP;AACF;AACDI,+BAASC,YAAT,CACI,OADJ,EACa;AACLC,yBAAS;AADJ,aADb,EAGOd,GAHP,EAGWC,GAHX,EAGe,YAAK;AACZA,oBAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,kCAArB;AACH,aALL;AAMH,SAZD;AAaH,KAdD;;AAgBA;AACAb,QAAIC,IAAJ,CAAS,QAAT,EAAmBa,mBAASC,YAAT,CACf,OADe,EACN;AACLC,iBAAS,KADJ;AAELC,eAAM;AAFD,KADM,CAAnB,EAIQC,mCAJR,EAI6BC,uBAJ7B;;AAMA;AACAnB,QAAIoB,GAAJ,CAAQ,SAAR,EAAmBL,4BAAnB,EAAiC,UAACb,GAAD,EAAMC,GAAN,EAAa;AAC1CA,YAAIkB,MAAJ;AACAlB,YAAIS,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,qBAArB;AACH,KAHD;;AAKAb,QAAIoB,GAAJ,CAAQ,KAAR,EAAeL,4BAAf,EAA6B,UAACb,GAAD,EAAKC,GAAL,EAAY;AACrCA,YAAIS,MAAJ,CAAW,GAAX,EAAgBU,IAAhB,CAAqBpB,IAAIqB,IAAzB;AACH,KAFD;;AAIA,WAAOvB,GAAP;AAEH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport { Router } from 'express';\r\nimport Account from '../model/account';\r\nimport bodyParser from 'body-parser';\r\nimport passport from 'passport';\r\nimport config from '../config';\r\n\r\nimport {generateAccessToken, respond, authenticate} from '../middleware/authMiddleware';\r\n\r\nexport default ({config, db}) => {\r\n    let api = Router();\r\n\r\n\r\n    //'v1/account'\r\n    api.post('/register', (req, res)=>{\r\n        Account.register(new Account({\r\n            username: req.body.email\r\n        }), req.body.password, function (err, account) {\r\n            if (err) {\r\n               return res.status(500).send('An error occured ' + err);\r\n            }\r\n            passport.authenticate(\r\n                'local', {\r\n                    session: false\r\n                })(req,res,()=> {\r\n                    res.status(200).send('successfully created new account');\r\n                }); \r\n        });\r\n    });\r\n\r\n    //'v1/account/login'\r\n    api.post('/login', passport.authenticate(\r\n        'local', {\r\n            session: false,\r\n            scope:[]\r\n        }), generateAccessToken, respond);\r\n \r\n    //'v1/account/logout'\r\n    api.get('/logout', authenticate, (req, res) =>{\r\n        res.logout();\r\n        res.status(200).send('successfully logout');\r\n    });\r\n\r\n    api.get('/me', authenticate, (req,res)=> {\r\n        res.status(200).json(req.user);\r\n    });\r\n\r\n    return api;\r\n\r\n};"]}